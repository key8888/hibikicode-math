<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hibikicode math lab</title>
    <link rel="icon" href="/static/favicon.ico" />
    <link rel="stylesheet" href="/static/styles.css" />
    <!-- ▼ BokehJSは読み込まない（app.jsでサーバーのバージョンに合わせて動的ロード） -->
    <script
      src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"
      defer
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/axios@1.6.5/dist/axios.min.js"
      defer
    ></script>
    <script>
      // Monaco の AMD ローダ設定
      window.require = {
        paths: { vs: "https://cdn.jsdelivr.net/npm/monaco-editor@0.43.0/min/vs" },
      };
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/monaco-editor@0.43.0/min/vs/loader.min.js"
      defer
    ></script>
    <!-- /static/app.js は ES Modules。BokehJS の動的ロードもここでやる -->
    <script src="/static/app.js" type="module" defer></script>
  </head>
  <body>
    <header class="toolbar">
      <h1>グラフで学ぶプログラミング</h1>
      <div class="toolbar-buttons">
        <button id="run-button" class="primary">実行</button>
        <button id="reset-button">リセット</button>
        <button id="call-teacher-button" class="accent">先生を召喚する</button>
      </div>
    </header>
    <main class="workspace">
      <section class="left-pane">
        <div class="tabs" role="tablist">
          <button class="tab active" data-tab="graph" role="tab">グラフ表示</button>
          <button class="tab" data-tab="lesson" role="tab">教材</button>
        </div>
        <div class="tab-content">
          <div id="graph" class="tab-panel active" role="tabpanel">
            <div id="bokeh-plot" class="plot-area"></div>
          </div>
          <div id="lesson" class="tab-panel" role="tabpanel">
            <header class="lesson-header">
              <h2 id="lesson-title">教材</h2>
              <div class="lesson-controls">
                <button id="prev-lesson" class="secondary">前へ</button>
                <button id="next-lesson" class="secondary">次へ</button>
              </div>
            </header>
            <article id="lesson-content" class="lesson-content">
              <p>教材を読み込んでいます...</p>
            </article>
          </div>
        </div>
      </section>

      <!-- 左右をドラッグするスプリッター -->
      <div id="vertical-splitter" class="splitter vertical" aria-hidden="true"></div>

      <section class="right-pane">
        <div class="editor-toolbar">
          <label for="font-size-control">フォントサイズ</label>
          <input
            type="range"
            id="font-size-control"
            min="12"
            max="24"
            value="15"
          />
          <span id="font-size-value">15px</span>
        </div>

        <div class="editor-log-container">
          <div id="editor" class="editor"></div>

          <!-- エディタとログをドラッグするスプリッター -->
          <div
            id="horizontal-splitter"
            class="splitter horizontal"
            aria-hidden="true"
          ></div>

          <section class="log-area">
            <header class="log-header">
              <h2>実行ログ</h2>
              <p>実行時間: <span id="execution-time">-</span></p>
            </header>
            <pre id="combined-log" class="log-output"></pre>
          </section>
        </div>
      </section>
    </main>

    <template id="default-code">
      from math import sin, cos

plot = new_plot(title="一次関数と二次関数")
plot_function(lambda x: x, x_start=-10, x_end=10, legend_label="y = x")
plot_function(lambda x: 0.2 * x**2 - 5, x_start=-10, x_end=10, legend_label="y = 0.2x^2 - 5", line_color="#ff7f0e")
plot.xaxis.axis_label = "x"
plot.yaxis.axis_label = "y"
print("グラフを描画しました！")
    </template>
  </body>
</html>
